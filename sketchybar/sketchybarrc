#!/bin/zsh

source "${CONFIG_DIR}/colors.sh"

bar=(
  display=1 # Only on internal display (if "main" sketchybar will flash on external display when closing laptop screen)
  notch_display_height=37
  position=top
  padding_left=15
  padding_right=15
  color=0x00000000
)

defaults=(
  icon.font="SF Pro:Medium:13"
  label.font="SF Pro:Medium:13"
)

current_app_icon=(
  padding_right=3
  background.drawing=on
  script="${CONFIG_DIR}/plugins/current_app.sh"
)

current_app_name=(
  padding_left=1
  label.font="SF Pro:Bold:13"
  script="${CONFIG_DIR}/plugins/current_app.sh"
)

next_meeting=(
  drawing=off
  padding_right=7
  script="${CONFIG_DIR}/plugins/next_meeting.sh"
  update_freq=10
)

battery_status=(
  padding_left=5
  padding_right=4
  background.corner_radius=9
  background.height=25
  icon="ô€›©"
  icon.padding_left=6
  icon.color="${DEFAULT_DARK}"
  label.padding_left=6
  label.padding_right=8
  label.color="${DEFAULT_DARK}"
  script="${CONFIG_DIR}/plugins/battery_status.sh"
  update_freq=60
)

date=(
  padding_left=6
  script="${CONFIG_DIR}/plugins/datetime.sh"
)

time=(
  padding_left=6
  padding_right=2
  script="${CONFIG_DIR}/plugins/datetime.sh"
  update_freq=10
)

sketchybar \
  --bar "${bar[@]}" \
  --default "${defaults[@]}" \
  --add event appearance_changed "AppleInterfaceThemeChangedNotification" \
  --add event date_changed "NSCalendarDayChangedNotification" \
  --add item current_app_icon left \
  --set current_app_icon "${current_app_icon[@]}" \
  --subscribe current_app_icon front_app_switched \
  --add item current_app_name left \
  --set current_app_name "${current_app_name[@]}" \
  --subscribe current_app_name appearance_changed front_app_switched \
  --add item time right \
  --set time "${time[@]}" \
  --subscribe time appearance_changed \
  --add item date right \
  --set date "${date[@]}" \
  --subscribe date appearance_changed date_changed \
  --add item battery_status right \
  --set battery_status "${battery_status[@]}" \
  --subscribe battery_status appearance_changed system_woke power_source_change \
  --add item next_meeting right \
  --set next_meeting "${next_meeting[@]}" \
  --subscribe next_meeting appearance_changed \
  --update
